<!DOCTYPE html>
<html>
  <head><title>ValueTube</title></head>
  <body>
    <script src="https://apis.google.com/js/api.js"></script>
    <script>
      /**
       * Sample JavaScript code for youtube.channels.list
       * See instructions for running APIs Explorer code samples locally:
       * https://developers.google.com/explorer-help/guides/code_samples#javascript
       */
      
      function authenticate() {
        return gapi.auth2.getAuthInstance()
            .signIn({scope: "https://www.googleapis.com/auth/youtube.force-ssl"})
            .then(function() { console.log("Sign-in successful"); },
                  function(err) { console.error("Error signing in", err); });
      }
      function loadClient() {
        gapi.client.setApiKey("AIzaSyDH3-W6b_8zwDbf9_gOgCoueqCG_fr1kFk");
        return gapi.client.load("https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest")
            .then(function() { console.log("GAPI client loaded for API"); },
                  function(err) { console.error("Error loading GAPI client for API", err); });
      }
      // Make sure the client is loaded and sign-in is complete before calling this method.
      function execute(vidId) {
        return gapi.client.youtube.videos.list({
          "part": "snippet,contentDetails,statistics",
          "id": vidId
        })
            .then(function(response) {
                    //console.log("Response", response);
                    //showVid(response["result"]);
                    createObj(response["result"]["items"][0])
                  },
                  function(err) { console.error("Execute error", err); });
      }
      gapi.load("client:auth2", function() {
        gapi.auth2.init({client_id: "678353975875-shl86pdiisrgg91dmck4pe4h1l8vdiul.apps.googleusercontent.com"});
      });

      function showVid(vid) {
        let snip = vid["items"][0]["snippet"];
        let img = document.createElement("img");
        img.src = snip["thumbnails"]["medium"]["url"];
        document.getElementById("vidDisplay").appendChild(img);

        let title = document.createElement("h3");
        title.innerText = snip["channelTitle"] + " -> " + snip["title"];
        document.getElementById("vidDisplay").appendChild(title);

        let p = document.createElement("p");
        p.innerText = snip["description"].substr(0,300);
        document.getElementById("vidDisplay").appendChild(p);
      }

      function executeSearch() {
        return gapi.client.youtube.search.list({
          "part": "snippet",
          "maxResults": 10,
          "type": "video",
          "q": document.getElementById("vidID").value
        })
            .then(function(response) {
                    // Handle the results here (response.result has the parsed body).
                    console.log("Response", response);
                    for (let res of response["result"]["items"]) {
                      execute(res["id"]["videoId"]);
                    }
                  },
                  function(err) { console.error("Execute error", err); });
      }

      function createObj(vid) {
        let snip = vid["snippet"];
        let stats = vid["statistics"];
        let videoData = {
          title: snip["title"],
          description: snip["description"],
          channelTitle: snip["channelTitle"],
          tags: snip["tags"],
          categoryId: snip["categoryId"],
          licencedContent: vid["contentDetails"]["licensedContent"],
          viewCount: stats["viewCount"],
          likeCount: stats["likeCount"],
          dislikeCount: stats["dislikeCount"],
          commentCount: stats["commentCount"]
        }
        console.log(videoData);
      }

      function clearDiv() {
        document.getElementById("vidDisplay").innerHTML = "";
      }

    </script>
    <label for="vidID">Search: </label><input type="text" id="vidID">
    <button onclick="authenticate().then(loadClient)">Authorize</button>
    <button onclick="executeSearch()">Search</button>
    <button onclick="clearDiv()">Clear</button>
    <br>
    <div id="vidDisplay"></div>
  </body>
</html>